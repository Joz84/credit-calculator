<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Calculator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        background-color: #ffffff;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2000 1500'%3E%3Cdefs%3E%3Crect stroke='%23ffffff' stroke-width='0.7' width='1' height='1' id='s'/%3E%3Cpattern id='a' width='3' height='3' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cuse fill='%23fcfcfc' href='%23s' y='2'/%3E%3Cuse fill='%23fcfcfc' href='%23s' x='1' y='2'/%3E%3Cuse fill='%23fafafa' href='%23s' x='2' y='2'/%3E%3Cuse fill='%23fafafa' href='%23s'/%3E%3Cuse fill='%23f7f7f7' href='%23s' x='2'/%3E%3Cuse fill='%23f7f7f7' href='%23s' x='1' y='1'/%3E%3C/pattern%3E%3Cpattern id='b' width='7' height='11' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23f5f5f5'%3E%3Cuse href='%23s'/%3E%3Cuse href='%23s' y='5' /%3E%3Cuse href='%23s' x='1' y='10'/%3E%3Cuse href='%23s' x='2' y='1'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='8'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='5' y='2'/%3E%3Cuse href='%23s' x='5' y='6'/%3E%3Cuse href='%23s' x='6' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='h' width='5' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23f5f5f5'%3E%3Cuse href='%23s' y='5'/%3E%3Cuse href='%23s' y='8'/%3E%3Cuse href='%23s' x='1' y='1'/%3E%3Cuse href='%23s' x='1' y='9'/%3E%3Cuse href='%23s' x='1' y='12'/%3E%3Cuse href='%23s' x='2'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='2'/%3E%3Cuse href='%23s' x='3' y='6'/%3E%3Cuse href='%23s' x='3' y='11'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='4' y='10'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='c' width='17' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23f2f2f2'%3E%3Cuse href='%23s' y='11'/%3E%3Cuse href='%23s' x='2' y='9'/%3E%3Cuse href='%23s' x='5' y='12'/%3E%3Cuse href='%23s' x='9' y='4'/%3E%3Cuse href='%23s' x='12' y='1'/%3E%3Cuse href='%23s' x='16' y='6'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='d' width='19' height='17' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23ffffff'%3E%3Cuse href='%23s' y='9'/%3E%3Cuse href='%23s' x='16' y='5'/%3E%3Cuse href='%23s' x='14' y='2'/%3E%3Cuse href='%23s' x='11' y='11'/%3E%3Cuse href='%23s' x='6' y='14'/%3E%3C/g%3E%3Cg fill='%23efefef'%3E%3Cuse href='%23s' x='3' y='13'/%3E%3Cuse href='%23s' x='9' y='7'/%3E%3Cuse href='%23s' x='13' y='10'/%3E%3Cuse href='%23s' x='15' y='4'/%3E%3Cuse href='%23s' x='18' y='1'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='e' width='47' height='53' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23E60F05'%3E%3Cuse href='%23s' x='2' y='5'/%3E%3Cuse href='%23s' x='16' y='38'/%3E%3Cuse href='%23s' x='46' y='42'/%3E%3Cuse href='%23s' x='29' y='20'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='f' width='59' height='71' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23E60F05'%3E%3Cuse href='%23s' x='33' y='13'/%3E%3Cuse href='%23s' x='27' y='54'/%3E%3Cuse href='%23s' x='55' y='55'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='g' width='139' height='97' patternUnits='userSpaceOnUse' patternTransform='scale(33) translate(-969.7 -727.27)'%3E%3Cg fill='%23E60F05'%3E%3Cuse href='%23s' x='11' y='8'/%3E%3Cuse href='%23s' x='51' y='13'/%3E%3Cuse href='%23s' x='17' y='73'/%3E%3Cuse href='%23s' x='99' y='57'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect fill='url(%23a)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23b)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23h)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23c)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23d)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23e)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23f)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23g)' width='100%25' height='100%25'/%3E%3C/svg%3E");
        background-attachment: fixed;
        background-size: cover;
      }
    </style>
  </head>
<body>

    <div class="container mt-5">
      <div class="text-center w-100">
        <h1 class="text-center">Credits Calculator</h1>
        <img class="rounded mb-3" src="https://avatars.githubusercontent.com/u/5470001?s=280&v=4" width="70px" alt="le wagon logo">
        <div class="row">
          <div class="col-md-10 offset-md-1">
            <p>
              This calculator allows you to estimate the number of credits a TA can claim based on the number of days worked. 
              The calculation is based on a tier system with increments of 5 days. Additionally, the number of days will yield 
              more credits if they are distributed across multiple batches. The tiers are as follows:
            </p>
            <table border="1" class="table table-striped">
                <thead>
                    <tr>
                        <th>Days</th>
                        <th>Batches</th>
                        <th>Credits</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>5</td>
                        <td>1</td>
                        <td>400</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>1</td>
                        <td>800</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>2</td>
                        <td>1000</td>
                    </tr>
                    <tr>
                        <td>40</td>
                        <td>4</td>
                        <td>4800</td>
                    </tr>
                </tbody>
            </table>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-md-5 offset-md-1">
          <div class="card mt-5 px-5 pb-5">
            <form id="calculator-form" class="mt-4">
              <div class="mb-3">
                  <label for="dayNbr" class="form-label">Number of Days</label>
                  <input type="number" id="dayNbr" class="form-control" placeholder="Enter number of days" required>
              </div>
              <div class="mb-3">
                  <label for="batchNbr" class="form-label">Number of Batches</label>
                  <input type="number" id="batchNbr" class="form-control" placeholder="Enter number of batches" required>
              </div>
              <button type="submit" class="btn btn-danger w-100">Calculate</button>
            </form>
          </div>
        </div>
        <div class="col-md-5">
          <div id="result" class="mt-4"></div>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
        function calculator(day_nbr, batch_nbr) {
            const refs = [
                [40, 4, 4800],
                [10, 2, 1000],
                [10, 1, 800],
                [5, 1, 400]
            ];
            const permutations = getPermutations(refs);
            let resultsCredits = [];
            let resultsCoeffs = [];
            let resultsRests = [];
            let day_nbr_0 = day_nbr;

            permutations.forEach((perm) => {
                let coeffs = [];
                let credits = 0;
                let day_nbr = day_nbr_0;

                perm.forEach((ref) => {
                    if (day_nbr / ref[0] >= 1 && batch_nbr / ref[1] >= 1) {
                        const min = Math.min(Math.floor(day_nbr / ref[0]), Math.floor(batch_nbr / ref[1]));
                        credits += min * ref[2];
                        day_nbr -= min * ref[0];
                        coeffs.push(min);
                    } else {
                        coeffs.push(0);
                    }
                });

                resultsRests.push(day_nbr);
                resultsCredits.push(credits);
                resultsCoeffs.push(coeffs);
            });

            const max = Math.max(...resultsCredits);
            const i = resultsCredits.indexOf(max);
            const coeffs = resultsCoeffs[i];
            const arr = [];
            coeffs.forEach((coeff, index) => {
                if (coeff > 0) arr.push(`${coeff} X ${refs[index][2]}`);
            });

            return {
                credits: max,
                coeffs: arr.join(" + "),
                rest: resultsRests[i]
            };
        }

        function getPermutations(array) {
            if (array.length === 1) return [array];
            const perms = [];
            array.forEach((item, i) => {
                const remaining = array.slice(0, i).concat(array.slice(i + 1));
                const subPerms = getPermutations(remaining);
                subPerms.forEach((subPerm) => perms.push([item, ...subPerm]));
            });
            return perms;
        }

        document.getElementById("calculator-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const dayNbr = parseInt(document.getElementById("dayNbr").value, 10);
            const batchNbr = parseInt(document.getElementById("batchNbr").value, 10);

            const result = calculator(dayNbr, batchNbr);
            const resultDiv = document.getElementById("result");

            resultDiv.innerHTML = `
                <div class="card w-100 mt-5">
                  <div class="card-body">
                    <h5 class="card-title text-center">Result</h5>
                    <p><strong>Credits:</strong> ${result.credits}</p>
                    <p><strong>Details:</strong> ${result.coeffs}</p>
                    <p><strong>Remaining Days:</strong> ${result.rest}</p>
                    <div class="text-center w-100">
                      <img width="100px" src="https://media.istockphoto.com/id/1125716911/es/vector/partido-popper-con-confeti.jpg?s=612x612&w=0&k=20&c=22BJBr7cPfVel8jl8mKEQjno0U1HqVMiEQiqttVucPY=" alt="">
                    </div>
                  </div>
                </div>
            `;
        });
    </script>
</body>
</html>
